name: print-changed-packages-version

on:
  pull_request:
    branches:
      - main

jobs:
  print-changed-packages:
    if: github.repository == 'creaticoding/assets-release-kit'
    name: 변경된 패키지 버전 출력 및 코멘트
    runs-on: ubuntu-latest

    steps:
      - name: Checkout 코드
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Node.js 설정
        uses: actions/setup-node@v3
        with:
          node-version: '22.x'

      - name: 의존성 설치
        run: yarn install

      - name: main 브랜치 최신 태그 및 커밋 가져오기
        run: |
          git fetch origin main --depth=1

      - name: 변경된 패키지 목록 계산
        id: changed
        run: |
          # --json: JSON 배열, --long: 이름·버전 포함 형태
          echo "changed=$(npx lerna changed --json --long)" >> $GITHUB_OUTPUT
        # lerna changed는 마지막 태그 기준으로 변경된 패키지를 이름만 또는 상세(long)로 출력합니다 :contentReference[oaicite:0]{index=0}.

      - name: PR에 변경 패키지 코멘트 남기기
        uses: peter-evans/create-or-update-comment@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          issue-number: ${{ github.event.pull_request.number }}
          body: |
            ### 📦 PR 기준 변경된 패키지 목록
            ```json
            ${{ steps.changed.outputs.changed }}
            ```
        # peter-evans/create-or-update-comment 액션으로 PR에 코멘트를 생성하거나 갱신합니다 :contentReference[oaicite:1]{index=1}.
